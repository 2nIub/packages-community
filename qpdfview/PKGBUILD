# Maintainer: Adam Reichold <adam.reichold@t-online.de>

pkgbase=qpdfview
pkgname=('qpdfview' 'qpdfview-djvu-plugin' 'qpdfview-ps-plugin')
pkgver=0.4.16
pkgrel=3
pkgdesc='A tabbed PDF viewer using the poppler library.'
arch=('i686' 'x86_64')
url='https://launchpad.net/qpdfview'
license=('GPL2')
depends=('libcups' 'poppler-qt5' 'qt5-svg' 'desktop-file-utils' 'hicolor-icon-theme')
optdepends=('qpdfview-ps-plugin: qpdfview plugin for PostScript support' 
            'qpdfview-djvu-plugin: qpdfview plugin for DjVu support')
makedepends=('qt5-tools' 'libspectre' 'djvulibre')
install='qpdfview.install'
source=("http://launchpad.net/$pkgname/trunk/$pkgver/+download/$pkgname-$pkgver.tar.gz"
        synctex_parser.diff::http://bazaar.launchpad.net/~adamreichold/qpdfview/trunk/diff/1944?context=3)
md5sums=('4b317c4536332a7fe437abe50eca1716'
         'bff5e2394f5871baafac73c0d12e87fa')

prepare() {
    cd "$srcdir/$pkgname-$pkgver"
    patch -Rp0 -i $srcdir/synctex_parser.diff
}

build() {
    cd "$srcdir/$pkgname-$pkgver"
    lrelease-qt5 qpdfview.pro
    qmake-qt5 "CONFIG+=$config" qpdfview.pro
    make
}

package_qpdfview() {
    cd "$srcdir/$pkgbase-$pkgver"
    make "INSTALL_ROOT=$pkgdir" install
    rm -f "${pkgdir}/usr/lib/qpdfview/libqpdfview_djvu.so"
    rm -f "${pkgdir}/usr/lib/qpdfview/libqpdfview_ps.so"
}

package_qpdfview-djvu-plugin() {
    depends=('qpdfview' 'djvulibre')
    cd "$srcdir/$pkgbase-$pkgver"
    install -Dm644 "libqpdfview_djvu.so" "${pkgdir}/usr/lib/qpdfview/libqpdfview_djvu.so"
}

package_qpdfview-ps-plugin() {
    depends=('qpdfview' 'libspectre')
    cd "$srcdir/$pkgbase-$pkgver"
    install -Dm644 "libqpdfview_ps.so" "${pkgdir}/usr/lib/qpdfview/libqpdfview_ps.so"
}
