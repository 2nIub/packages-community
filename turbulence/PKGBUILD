# Maintainer: dcell <sesshomaru@hushmail.com>
pkgname=turbulence
pkgver=0.3.3
pkgrel=1
pkgdesc="System configurer at boot for KDE and OpenBox, similar to Chakra's Kapudan."
url="http://manjaro.org"
depends=('python2' 'python2-pyqt4' 'pyqt4-common' 'qt4' 'wmctrl')
optdepends=('kdeplasma-theme-cupertino-ish' 'kde-theme-air-black-remix-green' 'lxterminal')
conflicts=('turbulence-evolution')
provides=('turbulence-evolution')
license=('GPL')
arch=('any')

_git="no"
_snapshot=12d29f36c2868a9e209c4e77ab9e1f48ab341a6d

if [ "$_git" == "yes" ]; then
    source=(git+http://git.manjaro.org/community/turbulence.git)
    sha256sums=('SKIP')
else
    source=("turbulence-$pkgver.tar.gz::http://git.manjaro.org/community/turbulence/repository/archive.tar.gz?ref=v$pkgver")
    sha256sums=('0f024447c19cc601fd5483cbccd6988e79532c501c18179bd71c08ac5a2e7439')
    #source=("turbulence-$pkgver-$pkgrel.tar.gz::http://git.manjaro.org/community/turbulence/repository/archive.zip?ref=$_snapshot")
    #sha256sums=('6a6a43f3c69d3eb22eaf246fa0fa33ecc7541a5b2c29ea6c0307a327cb26f42a')
fi

build() {
    if [ -e "$srcdir/community-$pkgname" ]; then
        _dir="$srcdir/community-$pkgname"
        cd $_dir
    fi
    if [ -e "$srcdir/$pkgname" ]; then
        _dir="$srcdir/$pkgname"
        cd $_dir
    fi
    if [ -e "$srcdir/$pkgname.git" ]; then
        _dir="$srcdir/$pkgname.git"
        cd $_dir
    fi

    lrelease-qt4 tr/*
}

package() {
    if [ -e "$srcdir/community-$pkgname" ]; then
        _dir="$srcdir/community-$pkgname"
        cd $_dir
    fi
    if [ -e "$srcdir/$pkgname" ]; then
        _dir="$srcdir/$pkgname"
        cd $_dir
    fi
    if [ -e "$srcdir/$pkgname.git" ]; then
        _dir="$srcdir/$pkgname.git"
        cd $_dir
    fi

    if [ -e "$_dir/.git" ]; then
        rm -r $_dir/.git
    fi

    mkdir -p $pkgdir/usr/bin
    mkdir -p $pkgdir/usr/share/turbulence
    mkdir -p $pkgdir/usr/share/wallpapers
    mkdir -p $pkgdir/usr/share/backgrounds
    
    mv $_dir/* $pkgdir/usr/share/turbulence
    mv $pkgdir/usr/share/turbulence/turbulence $pkgdir/usr/bin/turbulence
    mv $pkgdir/usr/share/turbulence/wallpapers/* $pkgdir/usr/share/wallpapers
    mv $pkgdir/usr/share/turbulence/backgrounds/* $pkgdir/usr/share/backgrounds
    
    rm -r $pkgdir/usr/share/turbulence/wallpapers
    rm -r $pkgdir/usr/share/turbulence/backgrounds
    rm -r $pkgdir/usr/share/turbulence/install.sh
    rm -r $pkgdir/usr/share/turbulence/translate.pro
    rm -r $pkgdir/usr/share/turbulence/create_ts
    rm -r $pkgdir/usr/share/turbulence/README.md
    
    chmod +x $pkgdir/usr/bin/turbulence
    chmod +x $pkgdir/usr/share/turbulence/turbulencerunner
}
