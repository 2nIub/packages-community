# Maintainer: dcell <sesshomaru@hushmail.com>

pkgname=turbulence
pkgver=0.2
pkgrel=2
pkgdesc="System configurer at boot for KDE, similar to Chakra's Kapudan."
url="http://manjaro.org"
depends=('python2' 'python2-pyqt4' 'pyqt4-common' 'qt4' 'kdeplasma-theme-cupertino-ish')
conflicts=('kdeplasma-theme-ghost-deco')
provides=('kdeplasma-theme-ghost-deco')
license=('GPL')
arch=('any')

_git=no
_snapshot=fdfdf62f6861d0d8a9cb282cc6322a99b60163c0

if [ "$_git" == "Yes" ]; then
   source=(git+http://git.manjaro.org/community/turbulence.git)
   sha256sums=('SKIP')
else
   #source=("turbulence-$pkgver.tar.gz::http://git.manjaro.org/community/turbulence/repository/archive?ref=v$pkgver")
   #sha256sums=('646bad5c4bb8b1b2fa049ae75a7e0adadeef791b222477ffd95a7e7da4b248ad')
   source=("turbulence-$pkgver-$pkgrel.tar.gz::http://git.manjaro.org/community/turbulence/repository/archive?ref=$_snapshot")
   sha256sums=('646bad5c4bb8b1b2fa049ae75a7e0adadeef791b222477ffd95a7e7da4b248ad')
fi

package() {
    if [ -e "$srcdir/community-$pkgname" ]; then
       _dir="$srcdir/community-$pkgname"
       cd $_dir
    fi
    if [ -e "$srcdir/$pkgname" ]; then
       _dir="$srcdir/$pkgname"
       cd $_dir
    fi
    if [ -e "$srcdir/$pkgname.git" ]; then
       _dir="$srcdir/$pkgname.git"
       cd $_dir
    fi
    mkdir -p $pkgdir/usr/bin
    mkdir -p $pkgdir/usr/share/turbulence
    mkdir -p $pkgdir/usr/share/apps/aurorae/themes
    mkdir -p $pkgdir/usr/share/wallpapers
    mv $_dir/turbulence $pkgdir/usr/bin/turbulence
    mv $_dir/themes/* $pkgdir/usr/share/apps/aurorae/themes

    # needs to be removed from git
    rm -r $pkgdir/usr/share/apps/aurorae/themes/cupertino-ish

    mv $_dir/wallpapers/* $pkgdir/usr/share/wallpapers
    rm -r $_dir/themes
    rm -r $_dir/wallpapers
    chmod +x $pkgdir/usr/bin/turbulence
    cp -r $_dir/* $pkgdir/usr/share/turbulence
    chmod +x $pkgdir/usr/share/turbulence/turbulencerunner
    chmod +x $pkgdir/usr/share/turbulence/install.sh
}
