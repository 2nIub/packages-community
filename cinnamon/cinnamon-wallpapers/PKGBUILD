# Maintainer: Bernhard Landauer <oberon@manjaro.org>

pkgname=cinnamon-wallpapers
_grepo=gnome-backgrounds
pkgver=20180203
pkgrel=1
pkgdesc="Wallpapers for Manjaro Cinnamon"
arch=('any')
license=('GPL3')
makedepends=('git'
    'glib2'
    'meson')
provides=("$_grepo")
conflicts=("$_grepo")
_gurl="https://git.gnome.org/browse/$_grepo"
_gcommit=ebb69030864690831b431a95dcea02dcd143815f
_murl="https://github.com/oberon2007/$pkgname"
_mcommit=0d27993878c27a1ead3de7e57ed7e61b9b12298a
source=("git+https://git.gnome.org/browse/gnome-backgrounds#commit=$_gcommit"
        "$pkgname-$_mcommit.tar.gz::$_murl/archive/$_mcommit.tar.gz")
sha256sums=('SKIP'
            '26477624a1584b74ca96f752e2f0384764bd824bc025faa9ce157e8d7caed081')

pkgver() {
    date +%Y%m%d
}

prepare() {
    mkdir build
}

build() {
    cd build
    meson --prefix=/usr --buildtype=release ../$_grepo
    ninja
}

package() {
    cd build
    DESTDIR="$pkgdir" ninja install

    # fix default dir listing
    cd $pkgdir/usr/share/gnome-background-properties
    rm adwaita.xml
    mv gnome-backgrounds.xml gnome.xml

    # add manjaro-cinnamon
    cd $srcdir/$pkgname-$_mcommit
    cp -r * $pkgdir/usr/share
    install -m644 manjaro.xml $pkgdir/usr/share/gnome-background-properties/manjaro-backgrounds.xml
}
