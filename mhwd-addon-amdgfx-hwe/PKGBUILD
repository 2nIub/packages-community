# Maintainer: Fabian(Tids) <plusfabi@gmail.com>
pkgname=mhwd-addon-amdgfx-hwe
pkgver=20161015 #date +%Y%m%d
pkgrel=1
pkgdesc="Enables some extras for the AMDGPU-open, and radeon(ati) stack, like OpenCL, VAAPI & VDPAU in Manjaro"
arch=('any')
url="https://forum.manjaro.org/t/amdgpu-improvements-for-manjaro"
install='INSTALL'
license=('custom')
depends=('mhwd-db' 'grub')
conflicts=('mhwd-addon-amdgpu-hwe')
source=('MHWDCONFIG_amdgpu-experimental-mesa-extras' 'MHWDCONFIG_amdgpu-mesa-extras' 'MHWDCONFIG_ati-mesa-extras' 'amdgpu-mesa.ids' 'amdgpu-mesa-experimental.ids' 'odamdgpu')
md5sums=('77a17c594a00288b320472b6ecd15f63'
         'c3a15653109a62dfb3a490f0c32bf05d'
         '6a2aeac18b015a72855b28c5c34f1a98'
         '5695d0fdbafad7775d3bf3c72999af43'
         '50dde55099f875c70670c405d10424b6'
         '246f3a7e35611179823d72968866c8f4')

package() 
{
    cd "${srcdir}"
    # Create Directories we need
    mkdir -p "${pkgdir}/var/lib/mhwd/db/pci/graphic_drivers/xf86-video-amdgpu-experimental-mesa-extras"
    mkdir -p "${pkgdir}/var/lib/mhwd/db/pci/graphic_drivers/xf86-video-amdgpu-mesa-extras"
    mkdir -p "${pkgdir}/var/lib/mhwd/db/pci/graphic_drivers/xf86-video-ati-mesa-extras"
    mkdir -p "${pkgdir}/var/lib/mhwd/ids/pci"
    
    # Install AMDGPU-experimental config file
    install -D -m644 "${srcdir}/MHWDCONFIG_amdgpu-experimental-mesa-extras" \
    "${pkgdir}/var/lib/mhwd/db/pci/graphic_drivers/xf86-video-amdgpu-experimental-mesa-extras/MHWDCONFIG"
    
    # Install PCI-ID file for AMDGPU-experimental Cards
    install -D -m644 "${srcdir}/amdgpu-mesa-experimental.ids" \
    "${pkgdir}/var/lib/mhwd/ids/pci/amdgpu-mesa-experimental.ids"
    
    # Install AMDGPU config file
    install -D -m644 "${srcdir}/MHWDCONFIG_amdgpu-mesa-extras" \
    "${pkgdir}/var/lib/mhwd/db/pci/graphic_drivers/xf86-video-amdgpu-mesa-extras/MHWDCONFIG"
    
    # Install PCI-ID file for AMDGPU Cards
    install -D -m644 "${srcdir}/amdgpu-mesa.ids" \
    "${pkgdir}/var/lib/mhwd/ids/pci/amdgpu-mesa.ids"
    
    # Install ATI/Radeon config file
    install -D -m644 "${srcdir}/MHWDCONFIG_ati-mesa-extras" \
    "${pkgdir}/var/lib/mhwd/db/pci/graphic_drivers/xf86-video-ati-mesa-extras/MHWDCONFIG"
    
    # Install odamdgpu
    install -D -m755 "${srcdir}/odamdgpu" \
    "${pkgdir}/usr/bin/odamdgpu"    
}
